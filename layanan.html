<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Kalkulator Harga</title>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-xl mx-auto mt-6 p-4 bg-gray-50 rounded shadow">
  <h2 class="text-xl font-bold text-gray-800 border-b pb-2 mb-4 flex items-center gap-2">
  <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
  </svg>
  Daftar Harga Semua Layanan
  </h2>
  <div id="nameButtons" class="flex flex-col"></div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<!-- Script (tidak berubah logika, hanya tampilan) -->
<script>
  const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOOIgoR9aon4ToLkBJDCnMQIphiknZrG1qSkPh9St_ayxYUOcApj4wx3y4T9lnPyCqwtYsAxBYg0Pd/pub?output=csv";
  let groupedData = {};
  
  const markupConfig = {
    "Facebook": { type: "fixed", value: 5000 },
    "Capcut": { type: "fixed", value: 5000 },
    "Discord": { type: "fixed", value: 5000 },
    "Instagram": { type: "fixed", value: 5000 },
    "Shopee": { type: "fixed", value: 5000 },
    "Telegram": { type: "fixed", value: 5000 },
    "Tiktok": { type: "fixed", value: 5000 },
    "Twitter": { type: "fixed", value: 5000 },
    "Youtube": { type: "fixed", value: 5000 }
  };
  
  function applyMarkup(category, basePrice) {
    const config = markupConfig[category];
    if (!config) return basePrice;
    return config.type === "percent"
      ? basePrice + (basePrice * config.value / 100)
      : basePrice + config.value;
  }
  
  Papa.parse(csvUrl, {
    download: true,
    header: true,
    complete: function(results) {
      const rawData = results.data;
      let lastName = "";
      const filledData = [];
  
      rawData.forEach(item => {
        if (item.name && item.name.trim() !== "") {
          lastName = item.name.trim();
        } else {
          item.name = lastName;
        }
        if (item.name && item.category) {
          filledData.push(item);
        }
      });
  
      groupedData = filledData.reduce((acc, item) => {
        if (!acc[item.name]) acc[item.name] = [];
        acc[item.name].push(item);
        return acc;
      }, {});
  
      renderNameButtons(Object.keys(groupedData));
    }
  });
  
  function renderNameButtons(names) {
    const container = document.getElementById("nameButtons");
    container.innerHTML = "";
  
    const groupedByPrefix = {};
    names.forEach(name => {
      const prefix = name.split(" ")[0];
      if (!groupedByPrefix[prefix]) groupedByPrefix[prefix] = [];
      groupedByPrefix[prefix].push(name);
    });
  
    const sortedPrefixes = Object.keys(groupedByPrefix).sort();
  
    sortedPrefixes.forEach(prefix => {
      const section = document.createElement("div");
      section.className = "mb-6";
  
      const heading = document.createElement("h3");
      heading.className = "text-xl font-bold text-gray-700 border-b pb-1 mb-3";
      heading.textContent = prefix;
      section.appendChild(heading);
  
      groupedByPrefix[prefix].forEach(name => {
        const wrapper = document.createElement("div");
        wrapper.className = "mb-2 rounded-lg overflow-hidden shadow border";
  
        const btn = document.createElement("button");
        btn.className = "w-full text-left px-4 py-3 bg-teal-100 hover:bg-teal-200 text-gray-800 font-medium flex justify-between items-center transition-all";
        btn.innerHTML = `
          ${name}
          <svg class="w-5 h-5 transition-transform transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        `;
  
        const contentDiv = document.createElement("div");
        contentDiv.className = "hidden transition-all duration-300 ease-in-out bg-white";
  
        btn.addEventListener("click", () => {
          contentDiv.classList.toggle("hidden");
          const icon = btn.querySelector("svg");
          icon.classList.toggle("rotate-180");
        });
  
        groupedData[name].forEach((item, index) => {
          const cleanPrice = item.price ? parseInt(item.price.replace(/\D/g, "")) : 0;
          const cleanMin = item.min ? parseInt(item.min.replace(/\D/g, "")) : 0;
          const cleanMax = item.max ? parseInt(item.max.replace(/\D/g, "")) : 0;
          const prefix = item.name.split(" ")[0];
          const finalPrice = applyMarkup(prefix, cleanPrice);
  
          const box = document.createElement("div");
          box.className = "p-4 border-t bg-white text-sm";
          box.innerHTML = `
            <p><strong>Layanan:</strong> <span class="text-red-500">${item.category}</span></p>
            <p class="mt-1"><strong>Harga:</strong> Rp ${finalPrice.toLocaleString()}/K</p>
  
            <div class="mt-3">
              <label class="block font-semibold mb-1">
                Jumlah 
                <span class="bg-teal-500 text-white text-xs font-semibold px-2 py-1 rounded ml-2">Min: ${cleanMin.toLocaleString()}</span>
                <span class="bg-teal-500 text-white text-xs font-semibold px-2 py-1 rounded ml-2">Max: ${cleanMax.toLocaleString()}</span>
              </label>
              <input type="number" class="jumlah-input border p-2 rounded w-full md:w-1/2 text-base focus:outline-none focus:ring-2 focus:ring-teal-400" min="${cleanMin}" max="${cleanMax}" placeholder="Masukkan jumlah" />
  
              <div class="mt-2">
                <label class="block font-semibold">Biaya</label>
                <div class="bg-gray-100 p-2 rounded w-full md:w-1/2">
                  Rp <span class="total-harga font-bold">0</span>
                </div>
              </div>
              <p class="text-xs text-gray-500 mt-2">*Masukkan jumlah, lalu klik tombol di bawah</p>
  
              <div class="mt-4">
                <a href="#" target="_blank" class="wa-btn inline-flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm transition">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M16.2 13.1c-.3-.2-1.7-.8-1.9-.9-.3-.1-.5-.2-.7.2s-.9.9-1.1 1c-.2.1-.4.1-.7-.1-.9-.5-1.6-1.1-2.2-2-.2-.3 0-.5.1-.6.1-.1.2-.2.3-.4.1-.1.1-.2.2-.3.1-.1.1-.2.2-.3.1-.2 0-.4-.1-.5-.1-.1-.7-1.7-1-2.3-.3-.5-.6-.4-.8-.4s-.4 0-.6 0c-.2 0-.5 0-.7.2-.2.2-1 1-1 2.4s1.1 2.8 1.3 3c.2.2 2.1 3.3 5.1 4.5.7.3 1.3.5 1.7.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 2-1.3.3-.6.3-1.2.2-1.3-.1-.1-.3-.2-.6-.3z"/>
                    <path d="M12 2C6.5 2 2 6.5 2 12c0 1.8.5 3.5 1.4 5L2 22l5.1-1.3c1.4.9 3.1 1.4 4.9 1.4 5.5 0 10-4.5 10-10S17.5 2 12 2zm0 18c-1.5 0-3-.4-4.3-1.2l-.3-.2-3 .8.8-2.9-.2-.3C4.4 15 4 13.5 4 12c0-4.4 3.6-8 8-8s8 3.6 8 8-3.6 8-8 8z"/>
                  </svg>
                  Order via WhatsApp
                </a>
              </div>
            </div>
          `;
  
          const input = box.querySelector(".jumlah-input");
          const totalEl = box.querySelector(".total-harga");
          const waBtn = box.querySelector(".wa-btn");
  
          input.addEventListener("input", function () {
            const jumlah = parseInt(this.value);
            if (!isNaN(jumlah)) {
              if (jumlah < cleanMin || jumlah > cleanMax) {
                totalEl.textContent = "Jumlah tidak valid";
                waBtn.href = "#";
              } else {
                const total = Math.round((jumlah * finalPrice) / 1000);
                totalEl.textContent = total.toLocaleString();
                const pesan = encodeURIComponent(`Halo saya mau order layanan:\n- Nama: ${item.name}\n- Layanan: ${item.category}\n- Jumlah: ${jumlah}\n- Estimasi biaya: Rp${total.toLocaleString()}`);
                waBtn.href = `https://wa.me/6285183104521?text=${pesan}`;
              }
            } else {
              totalEl.textContent = "0";
              waBtn.href = "#";
            }
          });
  
          contentDiv.appendChild(box);
        });
  
        wrapper.appendChild(btn);
        wrapper.appendChild(contentDiv);
        section.appendChild(wrapper);
      });
  
      container.appendChild(section);
    });
  }
</script>
</body>
</html>
